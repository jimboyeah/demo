<html>
  <head>
    <title>Basic Transmuxer Test</title>
  </head>
  <body>
    <link href="http://vjs.zencdn.net/7.8.2/video-js.min.css" rel="stylesheet">
    <script src="http://vjs.zencdn.net/7.8.2/video.min.js"></script>
    <video class="video-js">
      <source src="https://yiqikan.wuyouzuida.com/20201117/7591_d3b7f875/1000k/hls/b156cd55955000037.ts" type="video/ts">
      <source src="http://vjs.zencdn.net/v/oceans.webm" type="video/webm">
    </video>

    <!-- <script src="node_modules/mux.js/dist/mux.js"></script> -->
    <!-- <script SameSite="Lax" src="https://github.com/videojs/mux.js/releases/latest/download/mux.js"></script> -->
    <!--
    <video controls width="60%"></video>
     <script>
      // Create array of TS files to play
      segments = [
        // "https://yiqikan.wuyouzuida.com/20201117/7591_d3b7f875/1000k/hls/b156cd55955000008.ts",
        // "https://yiqikan.wuyouzuida.com/20201117/7591_d3b7f875/1000k/hls/b156cd55955000010.ts",
        // "https://yiqikan.wuyouzuida.com/20201117/7591_d3b7f875/1000k/hls/b156cd55955000025.ts",
        // "https://yiqikan.wuyouzuida.com/20201117/7591_d3b7f875/1000k/hls/b156cd55955000026.ts",
        "https://yiqikan.wuyouzuida.com/20201117/7591_d3b7f875/1000k/hls/b156cd55955000036.ts",
        "https://yiqikan.wuyouzuida.com/20201117/7591_d3b7f875/1000k/hls/b156cd55955000037.ts",
      ];

      for(var i=1000; i<1100; i++) {
        let it = segments[0];
        it = it.replace("036", i.toString().substring(1));
        // segments.push(it);
      }

      // Replace this value with your files codec info
      mime = 'video/mp4; codecs="mp4a.40.2,avc1.64001f"';

      let mediaSource = new MediaSource();
      let transmuxer = new muxjs.mp4.Transmuxer();

      video = document.querySelector('video');
      video.src = URL.createObjectURL(mediaSource);
      mediaSource.addEventListener("sourceopen", appendFirstSegment);

      function appendFirstSegment(){
        if (segments.length == 0){
          return;
        }

        URL.revokeObjectURL(video.src);
        sourceBuffer = mediaSource.addSourceBuffer(mime);
        sourceBuffer.addEventListener('updateend', appendNextSegment);

        transmuxer.on('data', (segment) => {
          let data = new Uint8Array(segment.initSegment.byteLength + segment.data.byteLength);
          data.set(segment.initSegment, 0);
          data.set(segment.data, segment.initSegment.byteLength);
          console.log(muxjs.mp4.tools.inspect(data));
          sourceBuffer.appendBuffer(data);
        })

        fetch(segments.shift()).then((response)=>{
          return response.arrayBuffer();
        }).then((response)=>{
          transmuxer.push(new Uint8Array(response));
          transmuxer.flush();
        })
      }

      function appendNextSegment(){
        // reset the 'data' event listener to just append (moof/mdat) boxes to the Source Buffer
        transmuxer.off('data');
        transmuxer.on('data', (segment) =>{
          sourceBuffer.appendBuffer(new Uint8Array(segment.data));
        })

        if (segments.length == 0){
          // notify MSE that we have no more segments to append.
          mediaSource.endOfStream();
        }

        segments.forEach((segment) => {
          // fetch the next segment from the segments array and pass it into the transmuxer.push method
          fetch(segments.shift()).then((response)=>{
            return response.arrayBuffer();
          }).then((response)=>{
            transmuxer.push(new Uint8Array(response));
            transmuxer.flush();
          })
        })
      }
    </script> -->
  </body>
</html>